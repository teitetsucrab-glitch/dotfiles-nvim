-- 2025/12/02 15:56 first stable-check ended
-- ==========================================================================
-- 0. 基本設定: Leaderキーをスペースキーに設定
-- ==========================================================================
-- 注意: これは必ずプラグインの読み込みよりも前に設定する必要があります

-- !!! init.luaで確定でvim.g.mapleaderとvim.g.maplocalleaderを読み込むようにすること
-- キーマッピングを短く書くためのショートカット
local map = vim.keymap.set
local opts = { noremap = true, silent = true }

-- ==========================================================================
-- 1. モード切替・基本操作の快適化
-- ==========================================================================

-- 'jk' でノーマルモードに戻る (入力モード時)
-- これでEscキーまで指を伸ばす必要がなくなります
map('i', 'jk', '<Esc>', opts)

-- 検索ハイライトを消す (ノーマルモード時)
-- Escを2回押すと、検索後の黄色いハイライトが消えます
map('n', '<Esc><Esc>', '<cmd>nohlsearch<CR>', opts)

-- Spaceキー単体では何もしない (Leaderとしての待機に専念させる)
map({ 'n', 'v' }, '<Space>', '<Nop>', { silent = true })

-- ==========================================================================
-- 2. 移動の快適化 (日本語/Markdown向け)
-- ==========================================================================

-- 見た目の行単位で移動する
-- 長い文章が折り返されているとき、視覚的な動きに合わせます
map('n', 'j', 'gj', opts)
map('n', 'k', 'gk', opts)

-- 行頭・行末への移動を直感的に (H = 行頭, L = 行末)
map('n', 'H', '^', opts)
map('n', 'L', '$', opts)

-- ==========================================================================
-- 3. ウィンドウ操作 (画面分割時)
-- ==========================================================================

-- Ctrl + hjkl でウィンドウ間を移動
map('n', '<C-h>', '<C-w>h', opts)
map('n', '<C-j>', '<C-w>j', opts)
map('n', '<C-k>', '<C-w>k', opts)
map('n', '<C-l>', '<C-w>l', opts)

-- ==========================================================================
-- 4. 編集操作
-- ==========================================================================
-- !!! options.luaでvim.opt.clipboardの設定を行う
-- !!! クリップボード関連とのコピーアンドペーストに関するキーマップは不要と判断

-- クリップボードへのコピー & ペースト (Windowsクリップボードと連携)
-- <Leader>y (Space + y) でクリップボードにコピー
-- map({'n', 'v'}, '<leader>y', '"+y', opts)
-- <Leader>p (Space + p) でクリップボードからペースト
-- map({'n', 'v'}, '<leader>p', '"+p', opts)

-- x で文字を消したときにクリップボード(レジスタ)を汚さない
-- (誤ってxで消した文字をペーストしてしまうのを防ぎます)
map('n', 'x', '"_x', opts)
-- D で文字を消したときにクリップボード(レジスタ)を汚さない
-- (誤ってDで消した文字をペーストしてしまうのを防ぎます)
map('n', 'D', '"_D', opts)
-- その行をまっさらにしたい時に使う(元々Xはカーソル前の文字を消すやつだったけど、正直いらない)
-- レジスタも避けられるよ
map('n', 'X', '0"_D', opts)


-- ==========================================================================
-- 5. コード実行・便利機能
-- ==========================================================================

-- <Leader>w でファイルを保存
map('n', '<leader>w', '<cmd>w<CR>', opts)
-- <Leader>q でファイルを閉じる
map('n', '<leader>q', '<cmd>q<CR>', opts)
-- <Leader>n で新しいタブを生成
map('n', '<leader>n', '<cmd>tabnew<CR>', opts)
-- ターミナルから抜けやすくなるといいな
map('t', '<C-]>', '<C-\\><C-n>', opts)


-- まとめてセーブをもっと自身持ってやりたい
-- 確認ダイアログがあったほうが嬉しいでしょ?
map('n', '<leader>zw', function()
	confirm = vim.fn.confirm("save all file?", "&Yes\n&No", 0)
	if confirm == 1 then
		-- バッファ上のすべてのファイルを保存
		vim.cmd('wall')
	elseif confirm == 2 then
		vim.notify("not saved", vim.log.levels.INFO)
	else
		vim.notify("command canceled", vim.log.levels.INFO)
	end
end, { desc = "save all files with confirmation"})


-- ==========================================================================
-- 6. プラグイン依存のショートカット
-- ==========================================================================
-- keymaps.lua に追加
-- ==== Themery ====
-- <Leader>t でテーマ切り替えメニューを開く
map('n', '<leader>t', '<cmd>Themery<CR>', opts)

-- ==== mini.files ====
-- キーマッピング（使いやすくするためのショートカット）
-- <Leader> はデフォルトでは "\" (バックスラッシュ) かスペースキーです
map('n', '<Leader>e', '<cmd>Files<CR>', { desc = 'ファイルを開く' })


-- ==== mini.pick ====
-- 各検索を呼び出すやつ
-- よく使う機能へのショートカット
vim.keymap.set('n', '<Leader>f', function()
	require('mini.pick').builtin.files()
end, { desc = 'Find Files' })
vim.keymap.set('n', '<Leader>g', function()
	require('mini.pick').builtin.grep_live()
end, { desc = 'Grep Live' })
vim.keymap.set('n', '<Leader>b', function()
	require('mini.pick').builtin.buffers()
end, { desc = 'Find Buffers' })
